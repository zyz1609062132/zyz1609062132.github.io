webpackJsonp([16],{"9WKf":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=s("mvHQ"),a=s.n(o),i=s("BO1k"),r=s.n(i),c=s("3pLw"),n={data:function(){return{addType:this.$route.query.type,addressBookForm:{cContactmgr:"",cCustno:"",cContactname:"",cContactdpt:"",cContactposition:"",cSex:"",cContactphone1:"",cContactphone2:"",cContactemail:"",cBirthday:"",cRemark:"",address:""},visitRecordForm:{cContactmgr:localStorage.getItem("usernameOfThisPeople"),manJoinmettingA:"",manJoinmettingB:"",cCustno:"",cVisittime:"",cSummary:"",cContactno:"",cContent:"",nextVisitTime:"",upcoming:""},particSearchOptionA:[],particSearchOptionB:[],salesManagerList:[],salesMgr:"",custmorNameList:[],contactPersonList:[],tempCCustName:"",tempCCustName2:"",tempCContactName:"",isDisabled:!1,visitCustNoEdit:!1}},components:{filterSelect:s("8BiH").a},mounted:function(){var t=this.$route.query.hasRecord,e=this.$route.query.cCustname,s=this.$route.query.cCustno;"02"==this.addType&&("hasRecord"==t&&this.getVisitDetail(),e&&s&&(this.visitRecordForm.cCustno=e,this.tempCCustName2=s,this.visitCustNoEdit=!0))},methods:{checkPhone1:function(){if(!/(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}/.test(this.addressBookForm.cContactphone1))return this.$message({message:"联系电话1格式不正确,请重新输入",type:"error"}),this.addressBookForm.cContactphone1="",!1},checkPhone2:function(){if(!/(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}/.test(this.addressBookForm.cContactphone2))return this.$message({message:"联系电话2格式不正确,请重新输入",type:"error"}),this.addressBookForm.cContactphone2="",!1},checkEmail:function(){if(!/^[A-Za-zd]+([-_.][A-Za-zd]+)*@([A-Za-zd]+[-.])+[A-Za-zd]{2,5}$/.test(this.addressBookForm.cContactemail))return this.$message({message:"邮箱格式不正确,请重新输入",type:"error"}),this.addressBookForm.cContactemail="",!1},listenIptValChg1:function(t){this.addressBookForm.cContactmgr=t,this.salesManagerList=[],this.checkSalesManager(t)},selectChnage1:function(t){this.addressBookForm.cContactmgr=t.value,this.salesMgr=t.key},listenIptValChg2:function(t){this.addressBookForm.cCustno=t,this.visitRecordForm.cCustno=t,this.custmorNameList=[],this.checkCustName(t)},selectChnage2:function(t){"add_new_customer"==t.key&&this.$router.push({path:"orgCustCreate"}),this.addressBookForm.cCustno=t.value,this.tempCCustName=t.key,this.visitRecordForm.cCustno=t.value,this.tempCCustName2=t.key},selectChnage3:function(t){this.visitRecordForm.manJoinmettingA=t,""===t[t.length-1]&&this.$router.push({path:"/crm/createAddress"})},listenIptValChg3:function(t){this.particSearchOptionA=[],this.checkMettingAList(t)},selectChnage4:function(t){this.visitRecordForm.manJoinmettingB=t},listenIptValChg4:function(t){this.particSearchOptionB=[],this.checkMettingBList(t)},custChange:function(t){for(var e=0;e<this.custmorNameList.length;e++)t==this.custmorNameList[e].value&&(this.tempCCustName=this.custmorNameList[e].label)},custChange2:function(t){for(var e=0;e<this.custmorNameList.length;e++)t==this.custmorNameList[e].value&&(this.tempCCustName2=this.custmorNameList[e].label)},contactPersonChange:function(t){for(var e=0;e<this.contactPersonList.length;e++)t==this.contactPersonList[e].value&&(this.tempCContactName=this.contactPersonList[e].label)},getVisitDetail:function(){var t=this,e={token:this.getLocalStorage("token"),h5loginusername:this.getLocalStorage("username")};c.a.post("/crm/custvisit/selectCuViByUmAccount",e).then(function(e){if(console.log(e),"0000"===e.code){var s=e.data.custvisitinfo;t.visitRecordForm.cCustno=s.cCustname,t.tempCCustName2=s.cCustno,t.visitRecordForm.cVisittime=s.dVisitdate,t.visitRecordForm.cSummary=s.cSummary,t.visitRecordForm.nextVisitTime=s.dFinishDate,t.visitRecordForm.upcoming=s.cSchedule,t.visitRecordForm.cContent=s.cContent;var o=t.getSelectitems("cContactno",s.visitContactList);t.visitRecordForm.manJoinmettingA=o.modelArr,t.particSearchOptionA=o.options;var a=t.getSelectitems("umAccount",s.visitMgrList);t.visitRecordForm.manJoinmettingB=a.modelArr,t.particSearchOptionB=a.options}}).catch(function(t){})},getSelectitems:function(t,e){var s=[],o=[],a=!0,i=!1,c=void 0;try{for(var n,m=r()(e);!(a=(n=m.next()).done);a=!0){var l=n.value;"cContactno"==t?(s.push(l.cContactno),o.push({cContactno:l.cContactno,cContactname:l.cContactname})):"umAccount"==t&&(s.push(l.cMgr),o.push({umAccount:l.cMgr,username:l.cUsername}))}}catch(t){i=!0,c=t}finally{try{!a&&m.return&&m.return()}finally{if(i)throw c}}return{modelArr:s,options:o}},checkSalesManager:function(t){var e=this,s={token:this.getLocalStorage("token"),h5loginusername:this.getLocalStorage("username"),username:t};c.a.post("/crm/sysuser/search",s).then(function(t){if("0000"===t.code&&t.data.list){var s=t.data.list,o=!0,a=!1,i=void 0;try{for(var c,n=r()(s);!(o=(c=n.next()).done);o=!0){var m=c.value;e.salesManagerList.push({key:m.umAccount,value:m.username})}}catch(t){a=!0,i=t}finally{try{!o&&n.return&&n.return()}finally{if(a)throw i}}}}).catch(function(t){})},checkCustName:function(t){var e=this,s={token:this.getLocalStorage("token"),h5loginusername:this.getLocalStorage("username"),cCustname:t};c.a.post("/crm/custinfo/searchName",s).then(function(t){if("0000"===t.code){if(t.data.list){var s=t.data.list,o=!0,a=!1,i=void 0;try{for(var c,n=r()(s);!(o=(c=n.next()).done);o=!0){var m=c.value;e.custmorNameList.push({key:m.cCustno,value:m.cCustname})}}catch(t){a=!0,i=t}finally{try{!o&&n.return&&n.return()}finally{if(a)throw i}}}0==t.data.list.length&&e.custmorNameList.push({key:"add_new_customer",value:"新建客户"})}}).catch(function(t){})},checkMettingAList:function(t){var e=this,s={token:this.getLocalStorage("token"),h5loginusername:this.getLocalStorage("username"),cContactname:t};c.a.post("/crm/custinfo/searchCon",s).then(function(t){if("0000"===t.code){var s=t.data.list;e.particSearchOptionA=s,s&&0==s.length&&e.particSearchOptionA.push({cContactno:"",cContactname:"新建联系人"})}}).catch(function(t){})},checkMettingBList:function(t){var e=this,s={token:this.getLocalStorage("token"),h5loginusername:this.getLocalStorage("username"),username:t};c.a.post("/crm/sysuser/search",s).then(function(t){if("0000"===t.code){var s=t.data.list;e.particSearchOptionB=s,s&&s.length}}).catch(function(t){})},routerBack:function(){this.addType&&(this.setSessionStorage("acName",this.addType),this.$router.go("-1"))},onSubmit:function(t){var e=this;if("1"==t){if(""==this.addressBookForm.cContactmgr||""==this.addressBookForm.cCustno||""==this.addressBookForm.cContactname||""==this.addressBookForm.cContactphone1||""==this.addressBookForm.cContactdpt)return void this.$message({message:"标记红色星号为必填项",type:"warning"});if(!/(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}/.test(this.addressBookForm.cContactphone1))return this.$message({message:"联系电话1格式不正确,请重新输入",type:"error"}),void(this.addressBookForm.cContactphone1="");if(this.addressBookForm.cContactphone2&&!/(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}/.test(this.addressBookForm.cContactphone2))return this.$message({message:"联系电话2格式不正确,请重新输入",type:"error"}),void(this.addressBookForm.cContactphone2="");if(this.addressBookForm.cContactemail&&!/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/.test(this.addressBookForm.cContactemail))return this.$message({message:"邮箱格式不正确,请重新输入",type:"error"}),void(this.addressBookForm.cContactemail="");this.isDisabled=!0;var s={token:this.getLocalStorage("token"),h5loginusername:this.getLocalStorage("username"),cCustno:this.tempCCustName,cCustname:this.addressBookForm.cCustno,cContactmgr:this.salesMgr,cContactname:this.addressBookForm.cContactname,cContactdpt:this.addressBookForm.cContactdpt,cContactposition:this.addressBookForm.cContactposition,cContactphone1:this.addressBookForm.cContactphone1,cContactphone2:this.addressBookForm.cContactphone2,cSex:this.addressBookForm.cSex,cBirthday:this.addressBookForm.cBirthday,cRemark:this.addressBookForm.cRemark,cContactemail:this.addressBookForm.cContactemail};c.a.post("/crm/custinfo/addAdrList",s).then(function(t){"0000"===t.code&&(e.$message({message:"新增成功",type:"success"}),e.routerBack()),e.isDisabled=!1}).catch(function(t){e.$message({message:"新增失败",type:"error"}),e.isDisabled=!1})}else if("2"==t){if(!(0!=this.visitRecordForm.manJoinmettingA.length&&this.tempCCustName2&&0!=this.visitRecordForm.manJoinmettingB.length&&""!=this.visitRecordForm.cVisittime&&this.visitRecordForm.cSummary&&this.visitRecordForm.cContent))return void this.$message({message:"标记红色星号为必填项",type:"warning"});this.isDisabled=!0;var o=a()(this.visitRecordForm.manJoinmettingA.map(function(t){return{value:t}})),i=a()(this.visitRecordForm.manJoinmettingB.map(function(t){return{value:t}})),r={token:this.getLocalStorage("token"),h5loginusername:this.getLocalStorage("username"),cCustno:this.tempCCustName2,cCustname:this.visitRecordForm.cCustno,dVisitdate:this.visitRecordForm.cVisittime,dFinishDate:this.visitRecordForm.nextVisitTime,cSchedule:this.visitRecordForm.upcoming,cSummary:this.visitRecordForm.cSummary,cContent:this.visitRecordForm.cContent,visitContact:o,visitMgr:i};c.a.post("/crm/custvisit/addCuVi",r).then(function(t){if("0000"===t.code){e.postMsgToClient({type:12}),e.$message({message:"新增成功",type:"success"}),e.routerBack()}e.isDisabled=!1}).catch(function(t){e.$message({message:"新增失败",type:"error"}),e.isDisabled=!1})}},changeCBirthday:function(t){this.addressBookForm.cBirthday=this.standardTime(t)},changeCVisittime:function(t){this.visitRecordForm.cVisittime=this.standardTime(t)},changeNextVisittime:function(t){this.visitRecordForm.nextVisitTime=this.standardTime(t)}}},m={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"createAddressBookAndVisitRecord-wrap pad10"},[o("div",{staticClass:"createAddressBookAndVisitRecord-main"},[o("span",{staticClass:"createAddressBookAndVisitRecord-main-back",on:{click:t.routerBack}},[o("img",{staticClass:"back-icon",attrs:{src:s("0YUB"),alt:""}}),t._v(" "),o("i",{staticStyle:{"padding-left":"5px",color:"#cf9f68"}},[t._v("返回")])]),t._v(" "),o("span",{staticClass:"createAddressBookAndVisitRecord-main-title"},[t._v(t._s("01"==this.addType?"新增通讯录":"新增拜访记录"))])]),t._v(" "),o("div",{staticClass:"createAddressBookAndVisitRecord-main-header pad10"},["01"==this.addType?o("div",{staticClass:"createAddressBookAndVisitRecord-main-body"},[o("el-form",{ref:"form",attrs:{model:t.addressBookForm}},[o("el-row",{attrs:{gutter:24}},[o("el-col",{attrs:{span:8}},[o("el-form-item",{attrs:{label:"销售经理",required:""}},[o("filter-select",{staticClass:"wid100pc",attrs:{initVal:t.addressBookForm.cContactmgr,placeholder:"查询销售经理",selectOptionData:t.salesManagerList},on:{listenIptValChange:t.listenIptValChg1,change:t.selectChnage1}})],1)],1),t._v(" "),o("el-col",{attrs:{span:8}},[o("el-form-item",{attrs:{label:"机构名称",required:""}},[o("filter-select",{staticClass:"wid100pc",attrs:{initVal:t.addressBookForm.cCustno,placeholder:"请输入机构名称关键词",selectOptionData:t.custmorNameList},on:{listenIptValChange:t.listenIptValChg2,change:t.selectChnage2}})],1)],1),t._v(" "),o("el-col",{attrs:{span:8}},[o("el-form-item",{attrs:{label:"联系人姓名",required:""}},[o("el-input",{staticClass:"modify-input",attrs:{placeholder:"请输入联系人姓名",maxlength:"160"},model:{value:t.addressBookForm.cContactname,callback:function(e){t.$set(t.addressBookForm,"cContactname",e)},expression:"addressBookForm.cContactname"}})],1)],1)],1),t._v(" "),o("el-row",{attrs:{gutter:24}},[o("el-col",{attrs:{span:8}},[o("el-form-item",{attrs:{label:"联系人部门",required:""}},[o("el-input",{staticClass:"modify-input",attrs:{placeholder:"请输入联系人部门",maxlength:"160"},model:{value:t.addressBookForm.cContactdpt,callback:function(e){t.$set(t.addressBookForm,"cContactdpt",e)},expression:"addressBookForm.cContactdpt"}})],1)],1),t._v(" "),o("el-col",{attrs:{span:8}},[o("el-form-item",{attrs:{label:"联系人职位"}},[o("el-input",{staticClass:"modify-input",attrs:{placeholder:"请输入联系人职位",maxlength:"160"},model:{value:t.addressBookForm.cContactposition,callback:function(e){t.$set(t.addressBookForm,"cContactposition",e)},expression:"addressBookForm.cContactposition"}})],1)],1),t._v(" "),o("el-col",{attrs:{span:8}},[o("el-form-item",{attrs:{label:"性别"}},[o("el-select",{staticClass:"modify-input",attrs:{placeholder:"请选择"},model:{value:t.addressBookForm.cSex,callback:function(e){t.$set(t.addressBookForm,"cSex",e)},expression:"addressBookForm.cSex"}},[o("el-option",{attrs:{label:"女",value:"0"}}),t._v(" "),o("el-option",{attrs:{label:"男",value:"1"}})],1)],1)],1)],1),t._v(" "),o("el-row",{attrs:{gutter:24}},[o("el-col",{attrs:{span:8}},[o("el-form-item",{attrs:{label:"联系电话1",required:""}},[o("el-input",{staticClass:"modify-input",attrs:{maxlength:"13",placeholder:"请输入联系电话"},on:{change:t.checkPhone1},model:{value:t.addressBookForm.cContactphone1,callback:function(e){t.$set(t.addressBookForm,"cContactphone1",e)},expression:"addressBookForm.cContactphone1"}})],1)],1),t._v(" "),o("el-col",{attrs:{span:8}},[o("el-form-item",{attrs:{label:"联系电话2"}},[o("el-input",{staticClass:"modify-input",attrs:{maxlength:"13",placeholder:"请输入联系电话"},on:{change:t.checkPhone2},model:{value:t.addressBookForm.cContactphone2,callback:function(e){t.$set(t.addressBookForm,"cContactphone2",e)},expression:"addressBookForm.cContactphone2"}})],1)],1),t._v(" "),o("el-col",{attrs:{span:8}},[o("el-form-item",{attrs:{label:"邮箱地址"}},[o("el-input",{staticClass:"modify-input",attrs:{placeholder:"请输入邮箱地址"},model:{value:t.addressBookForm.cContactemail,callback:function(e){t.$set(t.addressBookForm,"cContactemail",e)},expression:"addressBookForm.cContactemail"}})],1)],1)],1),t._v(" "),o("el-row",{attrs:{gutter:24}},[o("el-col",{attrs:{span:8}},[o("el-form-item",{attrs:{label:"出生日期"}},[o("el-date-picker",{staticClass:"modify-input",attrs:{editable:!1,type:"date",placeholder:"选择日期"},on:{change:t.changeCBirthday},model:{value:t.addressBookForm.cBirthday,callback:function(e){t.$set(t.addressBookForm,"cBirthday",e)},expression:"addressBookForm.cBirthday"}})],1)],1)],1),t._v(" "),o("el-row",{attrs:{gutter:24}},[o("el-col",{attrs:{span:24}},[o("el-form-item",{attrs:{label:"备注"}},[o("textarea",{directives:[{name:"model",rawName:"v-model",value:t.addressBookForm.cRemark,expression:"addressBookForm.cRemark"}],staticClass:"modify-input tempTextarea",staticStyle:{"-webkit-user-select":"auto"},attrs:{type:"text",maxlength:"160"},domProps:{value:t.addressBookForm.cRemark},on:{input:function(e){e.target.composing||t.$set(t.addressBookForm,"cRemark",e.target.value)}}})])],1)],1),t._v(" "),o("div",{staticClass:"btn-box"},[o("el-button",{on:{click:t.routerBack}},[t._v("取消")]),t._v(" "),o("el-button",{attrs:{type:"primary",disabled:t.isDisabled},on:{click:function(e){t.onSubmit(1)}}},[t._v("确定")])],1)],1)],1):t._e(),t._v(" "),"02"==this.addType?o("div",{staticClass:"createAddressBookAndVisitRecord-main-body"},[o("el-form",{ref:"form",attrs:{model:t.visitRecordForm}},[o("el-row",{attrs:{gutter:24}},[o("el-col",{attrs:{span:8}},[o("el-form-item",{attrs:{label:"甲方参会人员",required:""}},[o("el-select",{staticClass:"wid100pc ",attrs:{multiple:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入搜索甲方参会人员","remote-method":t.listenIptValChg3},on:{change:t.selectChnage3},model:{value:t.visitRecordForm.manJoinmettingA,callback:function(e){t.$set(t.visitRecordForm,"manJoinmettingA",e)},expression:"visitRecordForm.manJoinmettingA"}},t._l(t.particSearchOptionA,function(t){return o("el-option",{key:t.cContactno,attrs:{label:t.cContactname,value:t.cContactno}})}))],1)],1),t._v(" "),o("el-col",{attrs:{span:8}},[o("el-form-item",{attrs:{label:"机构名称",required:""}},[o("filter-select",{staticClass:"wid100pc",attrs:{initVal:t.visitRecordForm.cCustno,placeholder:"请输入机构名称关键词",disabled:t.visitCustNoEdit,selectOptionData:t.custmorNameList},on:{listenIptValChange:t.listenIptValChg2,change:t.selectChnage2}})],1)],1),t._v(" "),o("el-col",{attrs:{span:8}},[o("el-form-item",{attrs:{label:"我司陪同人员",required:""}},[o("el-select",{staticClass:"wid100pc ",attrs:{multiple:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入搜索我司陪同人员","remote-method":t.listenIptValChg4},on:{change:t.selectChnage4},model:{value:t.visitRecordForm.manJoinmettingB,callback:function(e){t.$set(t.visitRecordForm,"manJoinmettingB",e)},expression:"visitRecordForm.manJoinmettingB"}},t._l(t.particSearchOptionB,function(t){return o("el-option",{key:t.umAccount,attrs:{label:t.username,value:t.umAccount}})}))],1)],1)],1),t._v(" "),o("el-row",{attrs:{gutter:24}},[o("el-col",{attrs:{span:8}},[o("el-form-item",{attrs:{label:"拜访日期",required:""}},[o("el-date-picker",{staticClass:"modify-input",attrs:{editable:!1,type:"date",placeholder:"选择日期"},on:{change:t.changeCVisittime},model:{value:t.visitRecordForm.cVisittime,callback:function(e){t.$set(t.visitRecordForm,"cVisittime",e)},expression:"visitRecordForm.cVisittime"}})],1)],1),t._v(" "),o("el-col",{attrs:{span:8}},[o("el-form-item",{attrs:{label:"拜访摘要",required:""}},[o("el-input",{staticClass:"modify-input",attrs:{maxlength:"16",placeholder:"请输入拜访摘要"},model:{value:t.visitRecordForm.cSummary,callback:function(e){t.$set(t.visitRecordForm,"cSummary",e)},expression:"visitRecordForm.cSummary"}})],1)],1),t._v(" "),o("el-col",{attrs:{span:8}},[o("el-form-item",{attrs:{label:"下次完成时间"}},[o("el-date-picker",{staticClass:"modify-input",attrs:{editable:!1,type:"date",placeholder:"选择日期"},on:{change:t.changeNextVisittime},model:{value:t.visitRecordForm.nextVisitTime,callback:function(e){t.$set(t.visitRecordForm,"nextVisitTime",e)},expression:"visitRecordForm.nextVisitTime"}})],1)],1)],1),t._v(" "),o("el-row",{attrs:{gutter:24}},[o("el-col",{attrs:{span:24}},[o("el-form-item",{attrs:{label:"待办事项"}},[o("textarea",{directives:[{name:"model",rawName:"v-model",value:t.visitRecordForm.upcoming,expression:"visitRecordForm.upcoming"}],staticClass:"modify-input tempTextarea0",staticStyle:{"-webkit-user-select":"auto"},attrs:{type:"text",maxlength:"2000"},domProps:{value:t.visitRecordForm.upcoming},on:{input:function(e){e.target.composing||t.$set(t.visitRecordForm,"upcoming",e.target.value)}}})])],1)],1),t._v(" "),o("el-row",{attrs:{gutter:24}},[o("el-col",{attrs:{span:24}},[o("el-form-item",{attrs:{label:"拜访记录",required:""}},[o("textarea",{directives:[{name:"model",rawName:"v-model",value:t.visitRecordForm.cContent,expression:"visitRecordForm.cContent"}],staticClass:"modify-input tempTextarea",staticStyle:{"-webkit-user-select":"auto"},attrs:{type:"text",maxlength:"2000"},domProps:{value:t.visitRecordForm.cContent},on:{input:function(e){e.target.composing||t.$set(t.visitRecordForm,"cContent",e.target.value)}}})])],1)],1),t._v(" "),o("div",{staticClass:"btn-box"},[o("el-button",{on:{click:t.routerBack}},[t._v("取消")]),t._v(" "),o("el-button",{attrs:{type:"primary",disabled:t.isDisabled},on:{click:function(e){t.onSubmit(2)}}},[t._v("确定")])],1)],1)],1):t._e()])])},staticRenderFns:[]};var l=s("VU/8")(n,m,!1,function(t){s("b+sm")},"data-v-72c523ab",null);e.default=l.exports},"b+sm":function(t,e){}});