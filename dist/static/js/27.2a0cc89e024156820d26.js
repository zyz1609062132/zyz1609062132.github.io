webpackJsonp([27],{g3t3:function(t,e){},oM4t:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("BO1k"),o=a.n(n),s=a("mvHQ"),c=a.n(s),i=a("3pLw"),r={data:function(){return{activeName:"01",umAccount:"",umAccount2:"",username:"",salesManagerList:[],cCustno:"",cCustno2:"",cCustname:"",custmorNameList:[],addressBookList:[],visitRecordList:[],currPage1:1,pageSize1:50,totalSize1:1,currPage2:1,pageSize2:50,totalSize2:1,loading:null}},components:{filterSelect:a("8BiH").a},beforeDestroy:function(){localStorage.removeItem("abavr-data")},mounted:function(){var t=this.getSessionStorage("abavrType")?JSON.parse(this.getSessionStorage("abavrType")).activeIndex:"";this.activeName=t?t.toString():"01";var e=this.getLocalStorage("abavr-data");e&&this.setAbavrData(e),this.getUserInfo(),this.mountedData()},methods:{setAbavrData:function(t){var e=JSON.parse(t);"01"==this.activeName?(this.umAccount=e.custMgr.umAccount,this.username=e.custMgr.username,this.cCustno=e.custName.cCustno,this.cCustname=e.custName.cCustname,this.cContactno=e.contactName.cContactno,this.cContactname=e.contactName.cContactname,this.checkAddressBook()):"02"==this.activeName&&(this.umAccount2=e.custMgr.umAccount,this.username=e.custMgr.username,this.cCustno2=e.custName.cCustno,this.cCustname=e.custName.cCustname,this.cContactno=e.contactName.cContactno,this.cContactname=e.contactName.cContactname,this.checkVisitRecord())},checkAddressBook:function(){var t=this;this.loading=this.$loading({lock:!0,text:"正在加载...",spinner:"",background:"rgba(255, 255, 255, 0.6)"});var e={token:this.getLocalStorage("token"),h5loginusername:this.getLocalStorage("username"),cContactmgr:this.umAccount,cCustno:this.cCustno,limit:this.pageSize1,page:this.currPage1};i.a.post("/crm/custinfo/selectAdrList",e).then(function(e){"0000"===e.code&&e.data&&(t.addressBookList=e.data,t.totalSize1=e.count),t.loading.close()}).catch(function(e){t.loading.close()})},checkVisitRecord:function(){var t=this;this.loading=this.$loading({lock:!0,text:"正在加载...",spinner:"",background:"rgba(255, 255, 255, 0.6)"});var e={token:this.getLocalStorage("token"),h5loginusername:this.getLocalStorage("username"),cCreater:this.umAccount2,cCustno:this.cCustno2,limit:this.pageSize2,page:this.currPage2};i.a.post("/crm/custvisit/selectCuVi",e).then(function(e){"0000"===e.code&&e.data&&(t.visitRecordList=e.data,t.totalSize2=e.count),t.loading.close()}).catch(function(e){t.loading.close()})},mountedData:function(){this.checkAddressBook(),this.checkVisitRecord()},selectChnage1:function(t){this.umAccount=t.key},selectChnage4:function(t){this.umAccount2=t.key},selectChnage2:function(t){this.cCustno=t.key},selectChnage3:function(t){this.cCustno2=t.key},listenIptValChg1:function(t){this.umAccount="",this.checkSalesManager(t)},listenIptValChg4:function(t){this.umAccount2="",this.checkSalesManager(t)},listenIptValChg2:function(t){this.cCustno="",this.checkCustName(t)},listenIptValChg3:function(t){this.cCustno2="",this.checkCustName(t)},getUserInfo:function(){var t={token:this.getLocalStorage("token"),h5loginusername:this.getLocalStorage("username")};i.a.post("/crm/custinfo/getUserInfo",t).then(function(t){if("0000"===t.code){var e=t.data;localStorage.setItem("usernameOfThisPeople",e)}}).catch(function(t){})},goToDetail:function(t,e){if(t){var a=c()({activeIndex:e});this.setSessionStorage("abavrType",a),"01"==e&&this.setLocalStorage("address-book-history",c()(t)),this.$router.push({path:"updateAbavr",query:{type:e,cVisitid:t.cVisitid}})}},checkSalesManager:function(t){var e=this,a={token:this.getLocalStorage("token"),h5loginusername:this.getLocalStorage("username"),username:t};i.a.post("/crm/sysuser/search",a).then(function(t){if("0000"===t.code&&t.data.list){e.salesManagerList=[];var a=t.data.list,n=!0,s=!1,c=void 0;try{for(var i,r=o()(a);!(n=(i=r.next()).done);n=!0){var l=i.value;e.salesManagerList.push({key:l.umAccount,value:l.username})}}catch(t){s=!0,c=t}finally{try{!n&&r.return&&r.return()}finally{if(s)throw c}}}}).catch(function(t){})},checkCustName:function(t){var e=this,a={token:this.getLocalStorage("token"),h5loginusername:this.getLocalStorage("username"),cCustname:t};i.a.post("/crm/custinfo/searchName",a).then(function(t){if("0000"===t.code){e.custmorNameList=[];var a=t.data.list,n=!0,s=!1,c=void 0;try{for(var i,r=o()(a);!(n=(i=r.next()).done);n=!0){var l=i.value;e.custmorNameList.push({key:l.cCustno,value:l.cCustname})}}catch(t){s=!0,c=t}finally{try{!n&&r.return&&r.return()}finally{if(s)throw c}}}}).catch(function(t){})},handleClick:function(t,e){},renderheader:function(t,e){var a=e.column;e.$index;return t("span",{},[t("span",{},a.label.split("/")[0]),t("br"),t("span",{},a.label.split("/")[1])])},tableRowClassName:function(t){t.row,t.rowIndex;return"background-color: #FAFAFA;"},tableHeaderColor:function(t){t.row,t.column;var e=t.rowIndex;t.columnIndex;if(0===e)return"background-color: #F5ECE1;"},onSubmit:function(t){"1"==t?(this.currPage1=1,this.pageSize1=50,this.checkAddressBook()):"2"==t&&(this.currPage2=1,this.pageSize2=50,this.checkVisitRecord())},goToCreateAddressBookAndVisitRecord:function(t){if(t){var e=c()({activeIndex:t});this.setSessionStorage("abavrType",e);var a="";this.visitRecordList.length>0&&(a="hasRecord"),this.$router.push({path:"createAbavr",query:{type:t,hasRecord:a}})}},routerBack:function(){this.$router.go("-1")},handleCurrentChange1:function(t){this.currPage1=t,this.checkAddressBook()},handleCurrentChange2:function(t){this.currPage2=t,this.checkVisitRecord()},handleSizeChange1:function(t){this.pageSize1=t,this.currPage1=1,this.checkAddressBook()},handleSizeChange2:function(t){this.pageSize2=t,this.currPage2=1,this.checkVisitRecord()},custSexFormatter:function(t){var e="";switch(t.cSex){case"0":e="女";break;case"1":e="男";break;case null:e="--"}return e}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"v-channel-con padL10 padR10"},[a("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{staticClass:"abavrtab",attrs:{label:"通讯录",name:"01"}},[a("div",{staticClass:"tab-body-header"},[a("div",{staticClass:"control-left"},[a("span",[t._v("通讯录列表")])])]),t._v(" "),a("div",{staticClass:"tab-body-form"},[a("el-form",{ref:"form",attrs:{"label-width":"5rem"}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"客户名称"}},[a("filter-select",{staticClass:"wid100pc",attrs:{round:"",placeholder:"请查询客户",initVal:t.cCustname,selectOptionData:t.custmorNameList},on:{listenIptValChange:t.listenIptValChg2,change:t.selectChnage2}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"销售经理"}},[a("filter-select",{staticClass:"wid100pc",attrs:{round:"",placeholder:"请查询销售经理",initVal:t.username,selectOptionData:t.salesManagerList},on:{listenIptValChange:t.listenIptValChg1,change:t.selectChnage1}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"btn-box"},[a("el-button",{on:{click:function(e){t.onSubmit(1)}}},[t._v("查询")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.goToCreateAddressBookAndVisitRecord(t.activeName)}}},[t._v("新增通讯录")])],1)])],1)],1)],1),t._v(" "),a("div",{staticClass:"tab-body-main"},[a("el-table",{ref:"singleTable",staticStyle:{width:"100%"},attrs:{"tooltip-effect":"dark","header-cell-style":t.tableHeaderColor,"row-class-name":t.tableRowClassName,stripe:"",data:t.addressBookList,"max-height":"500"}},[a("el-table-column",{attrs:{label:"序号",fixed:"left",align:"center",width:"50px",type:"index"}}),t._v(" "),a("el-table-column",{attrs:{property:"cCustname",fixed:"left",label:"客户名称",align:"center","min-width":"180px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{on:{click:function(a){t.goToDetail(e.row,t.activeName)}}},[t._v(t._s(e.row.cCustname?e.row.cCustname:"--"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{property:"cContactname",label:"联系人",align:"center","min-width":"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{on:{click:function(a){t.goToDetail(e.row,t.activeName)}}},[t._v(t._s(e.row.cContactname?e.row.cContactname:"--"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{property:"cContactdpt",label:"部门",align:"center","min-width":"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{on:{click:function(a){t.goToDetail(e.row,t.activeName)}}},[t._v(t._s(e.row.cContactdpt?e.row.cContactdpt:"--"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{property:"cContactposition",label:"职位",align:"center","min-width":"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{on:{click:function(a){t.goToDetail(e.row,t.activeName)}}},[t._v(t._s(e.row.cContactposition?e.row.cContactposition:"--"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{property:"username",label:"销售经理",align:"center","min-width":"120px","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{on:{click:function(a){t.goToDetail(e.row,t.activeName)}}},[t._v(t._s(e.row.username?e.row.username:"--"))])]}}])})],1)],1),t._v(" "),t.addressBookList.length>0?a("div",{staticClass:"tab-body-footer"},[a("el-pagination",{attrs:{"page-sizes":[15,30,50],"page-size":t.pageSize1,"current-page":t.currPage1,layout:"prev, pager, next, sizes",background:"",total:t.totalSize1},on:{"size-change":t.handleSizeChange1,"current-change":t.handleCurrentChange1}})],1):t._e()]),t._v(" "),a("el-tab-pane",{attrs:{label:"拜访记录",name:"02"}},[a("div",{staticClass:"tab-body-header"},[a("div",{staticClass:"control-left"},[a("span",[t._v("拜访记录列表")])])]),t._v(" "),a("div",{staticClass:"tab-body-form"},[a("el-form",{ref:"form",attrs:{"label-width":"5rem"}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"客户名称"}},[a("filter-select",{staticClass:"wid100pc",attrs:{round:"",placeholder:"请查询客户",initVal:t.cCustname,selectOptionData:t.custmorNameList},on:{listenIptValChange:t.listenIptValChg3,change:t.selectChnage3}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"销售经理"}},[a("filter-select",{staticClass:"wid100pc",attrs:{round:"",placeholder:"请查询销售经理",initVal:t.username,selectOptionData:t.salesManagerList},on:{listenIptValChange:t.listenIptValChg4,change:t.selectChnage4}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"btn-box"},[a("el-button",{on:{click:function(e){t.onSubmit(2)}}},[t._v("查询")]),t._v(" "),a("el-button",{staticClass:"special-btn",attrs:{type:"primary"},on:{click:function(e){t.goToCreateAddressBookAndVisitRecord(t.activeName)}}},[t._v("新增拜访记录")])],1)])],1)],1)],1),t._v(" "),a("div",{staticClass:"tab-body-main"},[a("el-table",{ref:"singleTable",staticStyle:{width:"100%"},attrs:{"header-cell-style":t.tableHeaderColor,"row-class-name":t.tableRowClassName,stripe:"",data:t.visitRecordList,"max-height":"500"}},[a("el-table-column",{attrs:{label:"序号",align:"center",width:"50px",type:"index"}}),t._v(" "),a("el-table-column",{attrs:{property:"cContactname",label:"甲方参会人员",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{on:{click:function(a){t.goToDetail(e.row,t.activeName)}}},[t._v(t._s(e.row.cContactname?e.row.cContactname:"--"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{property:"cCustname",label:"客户名称",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{on:{click:function(a){t.goToDetail(e.row,t.activeName)}}},[t._v(t._s(e.row.cCustname?e.row.cCustname:"--"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{property:"cCreater",label:"销售经理",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{on:{click:function(a){t.goToDetail(e.row,t.activeName)}}},[t._v(t._s(e.row.cCreater?e.row.cCreater:"--"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{property:"username",label:"我司陪同人员",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{on:{click:function(a){t.goToDetail(e.row,t.activeName)}}},[t._v(t._s(e.row.username?e.row.username:"--"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{property:"dVisitdate",label:"拜访日期",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{on:{click:function(a){t.goToDetail(e.row,t.activeName)}}},[t._v(t._s(e.row.dVisitdate?e.row.dVisitdate:"--"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{property:"cContent",label:"拜访记录",align:"center","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{property:"cSchedule",label:"代办事项",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{on:{click:function(a){t.goToDetail(e.row,t.activeName)}}},[t._v(t._s(e.row.cSchedule?e.row.cSchedule:"--"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{property:"dFinishDate",label:"下次完成时间",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{on:{click:function(a){t.goToDetail(e.row,t.activeName)}}},[t._v(t._s(e.row.dFinishDate?e.row.dFinishDate:"--"))])]}}])})],1)],1),t._v(" "),t.visitRecordList.length>0?a("div",{staticClass:"tab-body-footer"},[a("el-pagination",{attrs:{"page-sizes":[15,30,50],"page-size":t.pageSize2,"current-page":t.currPage2,layout:"prev, pager, next, sizes",background:"",total:t.totalSize2},on:{"size-change":t.handleSizeChange2,"current-change":t.handleCurrentChange2}})],1):t._e()])],1)],1)},staticRenderFns:[]};var u=a("VU/8")(r,l,!1,function(t){a("g3t3")},"data-v-3f60549e",null);e.default=u.exports}});